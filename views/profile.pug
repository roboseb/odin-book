extends layout

block content
    include user-card
    include die

    #profile-info 
        - var  imgSrc = `../images/icons/${user_preview.pic}.png`
        if user_preview.pic.length !== 1
            - imgSrc = user_preview.pic

        .pic(style=`background-image: url(${imgSrc})`)
            #profile-details
                #profile-username= user_preview.username
                #profile-join-date= `Joined: ${user_preview.joinDate.toLocaleDateString("en-US")}` 
                #profile-likes= `${user_preview.likes} Likes`

    #friends-panels
        #friends-panel.panel
            .panel-header Friends

            each friend in user_preview.friends 
                    a.user-list-username.username(href=`/users/${friend.username}`)= friend.username
                        +user-card(friend)
        
        if user && user_preview.username === user.username
            #outgoing-panel.panel 
                .panel-header Outgoing Requests
                if user.outgoingRequests.length > 0
                    each request in user.outgoingRequests
                        div= request

            #incoming-panel.panel 
                .panel-header Incoming Requests
                if user.incomingRequests.length > 0
                    each request in user.incomingRequests
                        .accept-request-box
                            div= request
                            button#accept-request-btn(request=`${JSON.stringify(request)}`) Accept Friend


    #side-panels

        if user && user.username !== user_preview.username
            - var isFriend = false;
            each friend in user.friends 
                if friend.username === user_preview.username 
                    - isFriend = true
            #add-friend-btn.panel.collapsed
                - var friendText = 'Add Friend' 
                if isFriend
                    - friendText = `You are friends with ${user_preview.username}`
                     .panel-header=friendText
                else if user.outgoingRequests.includes(user_preview.username) 
                    - friendText = 'Friend request sent'
                     .panel-header=friendText
                else 
                    .panel-header#add-friend-panel(user=`${JSON.stringify(user_preview)}`)=friendText


            if isFriend
                #remove-friend-btn.panel.collapsed(user=`${JSON.stringify(user_preview)}`)
                    .panel-header Remove friend


        #dice-panel.panel 
            .panel-header Dice
            
            #user-dice
                #dice-info-preview
                    #dice-info 
                        div Pips #[span#pips-name]
                        div Base #[span#base-name]
                        div Inlay #[span#inlay-name]


                    #dice-preview 
                        for die, index in user_preview.dice
                            +die('khaki', die.pip, die.base, die.inlay, die.shine, die.pipped, die, user_preview.username, user ? user.username : null, user_preview, index)
                        button#last-die-btn Back
                        button#next-die-btn Next



                #dice-extras
                    #pipped-info Pipped! 
                    #shine-info Shiny!
                
                if user && user.username === user_preview.username
                    #die-card-options 
                        button.set-die-btn#set-1-btn(die=`${JSON.stringify('die')}`) Set as 1st die 
                        button.set-die-btn#set-2-btn(die=`${JSON.stringify('die')}`) Set as 2nd die 
                        button.set-die-btn#set-3-btn(die=`${JSON.stringify('die')}`) Set as 3rd die 
                        button.set-die-btn#set-4-btn(die=`${JSON.stringify('die')}`) Set as 4th die 
                        button.set-die-btn#set-5-btn(die=`${JSON.stringify('die')}`) Set as 5th die 
                        button.set-die-btn#set-6-btn(die=`${JSON.stringify('die')}`) Set as 6th die


        #equipped-dice-panel.panel
            .panel-header Equipped Dice
            
            #equipped-dice 
                for key in Object.keys(user_preview.setDice)
                    if user_preview.setDice[key] !== null
                        - var die = user_preview.setDice[key]

                        +die('khaki', die.pip, die.base, die.inlay, die.shine, die.pipped, die, user_preview.username, user ? user.username : null, user_preview)


    script(src='/javascripts/script.js')